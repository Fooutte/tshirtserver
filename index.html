<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HACK DALPHOND | NEXT-GEN STUDIO</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        :root {
            --primary: #00f2ff;
            --secondary: #7000ff;
            --bg: #0a0b10;
            --card: rgba(20, 22, 30, 0.8);
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--bg);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(112, 0, 255, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(0, 242, 255, 0.1) 0%, transparent 40%);
            color: #fff;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; overflow-x: hidden;
        }

        .container {
            background: var(--card);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 40px; border-radius: 20px;
            width: 100%; max-width: 500px;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.8);
        }

        .header-logo { text-align: center; margin-bottom: 35px; }
        .main-logo {
            width: 160px; height: auto; border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.4);
            margin-bottom: 15px; transition: transform 0.3s ease;
        }
        .main-logo:hover { transform: scale(1.05); }

        .header-subtitle {
            font-family: 'Orbitron', sans-serif; font-size: 1.1rem;
            letter-spacing: 8px; color: var(--primary);
            text-shadow: 0 0 15px var(--secondary);
            margin: 0; text-transform: uppercase; opacity: 0.9;
        }

        .preview-box {
            background: #fff; border-radius: 15px;
            height: 220px; display: flex; justify-content: center; align-items: center;
            position: relative; margin-bottom: 25px; overflow: hidden;
        }

        .tshirt-visual { width: 160px; transition: 0.3s; fill: white; }
        #custom-image-preview {
            position: absolute; top: 52%; left: 50%;
            transform: translate(-50%, -50%);
            max-width: 40px; max-height: 40px; pointer-events: none;
        }

        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; color: var(--primary); margin-bottom: 5px; letter-spacing: 1px; }

        input, select {
            width: 100%; padding: 12px; background: rgba(0,0,0,0.3);
            border: 1px solid #333; border-radius: 5px; color: white;
            font-family: 'Rajdhani'; font-size: 16px; box-sizing: border-box;
        }

        .color-grid { display: flex; gap: 10px; margin-top: 5px; }
        .color-opt {
            width: 25px; height: 25px; border-radius: 50%; cursor: pointer;
            border: 2px solid transparent; transition: 0.2s;
        }
        .color-opt.active { border-color: var(--primary); transform: scale(1.2); }

        .price-display {
            background: rgba(0, 242, 255, 0.1);
            border: 1px dashed var(--primary);
            padding: 15px; border-radius: 10px;
            text-align: center; margin: 20px 0;
        }

        .total-amount { font-family: 'Orbitron'; font-size: 24px; color: var(--primary); text-shadow: 0 0 10px var(--primary); }
        .discount-badge { font-size: 12px; color: #2ecc71; display: none; margin-top: 5px; }

        button {
            width: 100%; padding: 15px;
            background: linear-gradient(45deg, var(--secondary), var(--primary));
            border: none; border-radius: 5px; color: white;
            font-family: 'Orbitron'; font-weight: bold; cursor: pointer;
            transition: 0.3s; text-transform: uppercase; margin-top: 10px;
        }

        button:hover { filter: brightness(1.2); box-shadow: 0 0 20px var(--primary); }
        button:disabled { filter: grayscale(1); cursor: not-allowed; }

        #stripe-section {
            margin-top: 25px; padding-top: 25px;
            border-top: 1px solid rgba(255,255,255,0.1);
            display: none;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-logo">
        <img src="logo.png" alt="Logo Hack Studio" class="main-logo">
        <h2 class="header-subtitle">NEXT-GEN BOUTIQUE</h2>
    </div>

    <div class="preview-box">
        <svg id="tshirt-svg" class="tshirt-visual" viewBox="0 0 24 24"><path d="M20.91 4.58l-3.83-2.3a1.002 1.002 0 0 0-1.16.09l-3.92 3.14-3.92-3.14a1.002 1.002 0 0 0-1.16-.09l-3.83 2.3c-.56.33-.84.97-.68 1.6l1.41 5.34c.05.2.2.36.4.41l1.59.41V21c0 .55.45 1 1 1h10c.55 0 1-.45 1-1v-6.66l1.59-.41c.2-.05.35-.21.4-.41l1.41-5.34c.16-.63-.12-1.27-.68-1.6z"/></svg>
        <img id="custom-image-preview" src="" style="display:none;">
    </div>

    <div class="form-group">
        <label>LOGOTYPE (IMAGE)</label>
        <input type="file" id="imageInput" accept="image/*" onchange="previewImage(event)">
    </div>

    <div class="form-group">
        <label>COULEUR DU VÊTEMENT</label>
        <div class="color-grid">
            <div class="color-opt active" style="background: white;" onclick="setColor('white', this)"></div>
            <div class="color-opt" style="background: #111;" onclick="setColor('#111', this)"></div>
            <div class="color-opt" style="background: #e74c3c;" onclick="setColor('#e74c3c', this)"></div>
            <div class="color-opt" style="background: #3498db;" onclick="setColor('#3498db', this)"></div>
            <div class="color-opt" style="background: #2ecc71;" onclick="setColor('#2ecc71', this)"></div>
        </div>
    </div>

    <div class="form-group">
        <label>MODÈLE</label>
        <select id="productType" onchange="calculatePrice()">
            <option value="tshirt">T-Shirt (25.00 $)</option>
            <option value="hoodie">Hoodie (45.00 $)</option>
        </select>
    </div>

    <div style="display: flex; gap: 15px;">
        <div class="form-group" style="flex: 2;">
            <label>TAILLE</label>
            <select id="size">
                <option>S</option><option>M</option><option>L</option><option>XL</option>
            </select>
        </div>
        <div class="form-group" style="flex: 1;">
            <label>QUANTITÉ</label>
            <input type="number" id="qty" value="1" min="1" oninput="calculatePrice()">
        </div>
    </div>

    <div class="price-display">
        <label>TOTAL ESTIMÉ</label>
        <div class="total-amount"><span id="totalPrice">25.00</span> $</div>
        <div id="discount" class="discount-badge">RABAIS DE GROUPE APPLIQUÉ (-10%)</div>
    </div>

    <div class="form-group">
        <label>COORDONNÉES</label>
        <input type="text" id="name" placeholder="Nom complet" style="margin-bottom: 10px;">
        <input type="email" id="email" placeholder="Email">
    </div>

    <button onclick="startCheckout()" id="prepareBtn">PRÉPARER MA COMMANDE</button>

    <div id="stripe-section">
        <label>PAIEMENT SÉCURISÉ (STRIPE)</label>
        <div id="payment-element" style="margin: 20px 0;"></div>
        <button id="submit-payment" onclick="confirmPayment()">CONFIRMER LE PAIEMENT</button>
        <div id="error-message" style="color: #ff4d4d; margin-top: 10px; font-size: 14px;"></div>
    </div>
</div>

<script>
    // --- CONFIGURATION STRIPE ---
    const stripe = Stripe('pk_test_51SgTPbQ6SILjcuOFNUGeQNCpGdaGO5XV8EV5lohMhNyBKfZHKDYGchBdBICz17trHQXqj8L4wgXudszNWAu8kVa600vYcpNzZq');
    let elements;
    let selectedColor = 'white';
    let base64Image = "";

    async function startCheckout() {
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const prepareBtn = document.getElementById('prepareBtn');

        if(!name || !email) return alert("Veuillez remplir vos coordonnées !");

        prepareBtn.innerText = "INITIALISATION...";
        prepareBtn.disabled = true;

        try {
            // Utilisation du domaine exact de ton déploiement Vercel
           const response = await fetch('https://tshirtserver.vercel.app/api/create-payment-intent', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    amount: document.getElementById('totalPrice').innerText,
                    email: email,
                    metadata: {
                        name: name,
                        product: document.getElementById('productType').value,
                        size: document.getElementById('size').value,
                        color: selectedColor
                    }
                })
            });

            const data = await response.json();
            const clientSecret = data.clientSecret;

            const appearance = {
                theme: 'night',
                variables: {
                    colorPrimary: '#00f2ff',
                    colorBackground: '#1a1b23',
                    colorText: '#ffffff',
                    fontFamily: 'Rajdhani, sans-serif',
                }
            };

            elements = stripe.elements({ clientSecret, appearance });
            const paymentElement = elements.create('payment');
            
            document.getElementById('stripe-section').style.display = 'block';
            paymentElement.mount('#payment-element');
            prepareBtn.style.display = 'none';

        } catch(e) {
            console.error(e);
            alert("Erreur lors de la préparation. Vérifie ton serveur.");
            prepareBtn.disabled = false;
            prepareBtn.innerText = "RÉESSAYER";
        }
    }

    async function confirmPayment() {
        const submitBtn = document.getElementById('submit-payment');
        submitBtn.disabled = true;
        submitBtn.innerText = "TRAITEMENT EN COURS...";

        const { error } = await stripe.confirmPayment({
            elements,
            confirmParams: {
                return_url: window.location.href,
            },
        });

        if (error) {
            document.getElementById('error-message').innerText = error.message;
            submitBtn.disabled = false;
            submitBtn.innerText = "CONFIRMER LE PAIEMENT";
        }
    }

    function calculatePrice() {
        const qty = document.getElementById('qty').value;
        const type = document.getElementById('productType').value;
        const tshirtSvg = document.getElementById('tshirt-svg');
        
        if (type === 'hoodie') {
            tshirtSvg.innerHTML = '<path d="M12 3c-1.1 0-2.12.33-3 .9V6c0 1.1.9 2 2 2h2c1.1 0 2-.9 2-2V3.9c-.88-.57-1.9-.9-3-.9zM5 8c-1.1 0-2 .9-2 2v3c0 .55.45 1 1 1h1v7c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2v-7h1c.55 0 1-.45 1-1v-3c0-1.1-.9-2-2-2h-3.1c-.45 1.72-2 3-3.9 3s-3.45-1.28-3.9-3H5z"/>';
        } else {
            tshirtSvg.innerHTML = '<path d="M20.91 4.58l-3.83-2.3a1.002 1.002 0 0 0-1.16.09l-3.92 3.14-3.92-3.14a1.002 1.002 0 0 0-1
.16.09l-3.92 3.14-3.92-3.14a1.002 1.002 0 0 0-1.16-.09l-3.83 2.3c-.56.33-.84.97-.68 1.6l1.41 5.34c.05.2.2.36.4.41l1.59.41V21c0 .55.45 1 1 1h10c.55 0 1-.45 1-1v-6.66l1.59-.41c.2-.05.35-.21.4-.41l1.41-5.34c.16-.63-.12-1.27-.68-1.6z"/>';
        }

        const unitPrice = (type === 'hoodie') ? 45 : 25;
        let total = qty * unitPrice;
        if (qty >= 5) {
            total = total * 0.9;
            document.getElementById('discount').style.display = 'block';
        } else {
            document.getElementById('discount').style.display = 'none';
        }
        document.getElementById('totalPrice').innerText = total.toFixed(2);
    }

    function setColor(color, el) {
        selectedColor = color;
        document.getElementById('tshirt-svg').style.fill = color;
        document.querySelectorAll('.color-opt').forEach(opt => opt.classList.remove('active'));
        el.classList.add('active');
    }

    function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function() {
            const img = document.getElementById('custom-image-preview');
            img.src = reader.result;
            img.style.display = 'block';
            base64Image = reader.result;
        }
        if(event.target.files[0]) reader.readAsDataURL(event.target.files[0]);
    }

    // Initialisation au chargement
    calculatePrice();
</script>

</body>
</html>
